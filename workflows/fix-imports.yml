name: ğŸ”§ Fix Lucide & Sonner Imports

on:
  # Permet de dÃ©clencher manuellement depuis GitHub Actions UI
  workflow_dispatch:
  # Ou dÃ©clenchement automatique sur push vers main
  # push:
  #   branches: [ main ]

jobs:
  fix-imports:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: ğŸ”§ Run import fix script
        run: |
          python3 fix_all_now.py
          
      - name: ğŸ“Š Check if files were modified
        id: check_changes
        run: |
          if [[ -n $(git status -s) ]]; then
            echo "changes=true" >> $GITHUB_OUTPUT
            echo "âœ… Des fichiers ont Ã©tÃ© modifiÃ©s"
            git status -s
          else
            echo "changes=false" >> $GITHUB_OUTPUT
            echo "â„¹ï¸ Aucune modification nÃ©cessaire"
          fi
          
      - name: ğŸ“ Commit changes
        if: steps.check_changes.outputs.changes == 'true'
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "GitHub Actions Bot"
          git add -A
          git commit -m "ğŸ”§ fix: Correction automatique des imports lucide-react@0.550.0 et sonner@2.0.3

          - Remplace tous les imports 'lucide-react' par 'lucide-react@0.550.0'
          - Remplace tous les imports 'sonner' par 'sonner@2.0.3'
          - Correction automatique via GitHub Actions
          
          Version: v517.$(date +%s)
          Build: Ready for Vercel deployment"
          
      - name: ğŸš€ Push changes
        if: steps.check_changes.outputs.changes == 'true'
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}
          
      - name: âœ… Summary
        if: steps.check_changes.outputs.changes == 'true'
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  âœ… CORRECTION TERMINÃ‰E AVEC SUCCÃˆS !                          â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ‰ Les imports ont Ã©tÃ© corrigÃ©s et committÃ©s"
          echo "ğŸš€ Vercel va dÃ©ployer automatiquement la nouvelle version"
          echo ""
          echo "ğŸ“‹ Prochaines Ã©tapes :"
          echo "   1. VÃ©rifiez les logs de build sur Vercel"
          echo "   2. Le dÃ©ploiement devrait rÃ©ussir maintenant"
          echo ""
          
      - name: â„¹ï¸ No changes needed
        if: steps.check_changes.outputs.changes == 'false'
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  â„¹ï¸ AUCUNE CORRECTION NÃ‰CESSAIRE                               â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "âœ… Tous les imports sont dÃ©jÃ  corrects !"
          echo ""
